<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Auth ‚Äî So Jobless BH</title>

  <!-- Base styles you already use -->
  <link rel="stylesheet" href="./styles.css" />
  <link rel="stylesheet" href="./app.css" />

  <style>
    /* ===== Clean + Creative Redesign (no flips) ===== */

    /* Utility */
    .hidden { display: none !important; }

    /* Page */
    body { background: #fff; color: #111827; }

    /* Subtle gradient header band */
    .band {
      background: radial-gradient(1200px 400px at 10% -20%, #ffd1d1 0%, rgba(255,209,209,0) 40%),
                  radial-gradient(900px 380px at 90% -30%, #ffeab2 0%, rgba(255,234,178,0) 45%),
                  radial-gradient(800px 300px at 40% -40%, #d2f5ea 0%, rgba(210,245,234,0) 35%);
    }

    /* Card shell */
    .shell {
      border: 1px solid #f1f5f9;
      border-radius: 20px;
      background: #ffffffcc;
      backdrop-filter: blur(8px);
      box-shadow: 0 10px 30px rgba(16, 24, 40, 0.06);
    }

    /* Tabs */
    .tabs {
      display: inline-flex;
      gap: 6px;
      padding: 6px;
      border-radius: 12px;
      background: #f8fafc;
      border: 1px solid #eef2f7;
    }
    .tab {
      padding: 10px 14px;
      border-radius: 10px;
      font-weight: 700;
      font-size: 14px;
      color: #64748b;
      line-height: 1;
      border: 1px solid transparent;
      cursor: pointer;
    }
    .tab.active {
      background: #fff;
      color: #111827;
      border-color: #e5e7eb;
      box-shadow: 0 1px 0 rgba(0,0,0,.02) inset;
    }

    /* Inputs */
    .field {
      width: 100%;
      border: 1px solid #e5e7eb;
      border-radius: 12px;
      padding: 12px 14px;
      font-size: 14px;
      outline: none;
      transition: box-shadow .2s ease, border-color .2s ease;
      background: #fff;
    }
    .field:focus { border-color: #fd2f4b; box-shadow: 0 0 0 4px rgba(253,47,75,.12); }

    /* Buttons */
    .btn {
      border-radius: 12px;
      padding: 12px 16px;
      font-weight: 800;
      line-height: 1;
      border: 1px solid transparent;
    }
    .btn-primary { background:#fd2f4b; color:#fff; }
    .btn-primary:hover { filter: brightness(0.97); }
    .btn-ghost { background:#fff; color:#111827; border-color:#e5e7eb; }
    .btn-ghost:hover { background:#f8fafc; }

    .disabled { opacity:.6; pointer-events:none; }

    /* Alerts */
    .alert { border-radius: 12px; padding: 10px 12px; font-size: 13px; }
    .alert-err { border:1px solid #fecaca; background:#fee2e2; color:#7f1d1d; }
    .alert-ok  { border:1px solid #bbf7d0; background:#dcfce7; color:#14532d; }

    /* Small helpers */
    .muted { color:#64748b; font-size:12px; }
    .hint  { color:#475569; font-size:12px; }
    .stack { display:grid; gap:12px; }
    .stack-lg { display:grid; gap:16px; }
    .row { display:flex; gap:12px; }

    /* HyperApply logo (text-based) */
    .hyper-logo{display:inline-flex;align-items:baseline;gap:.25rem;line-height:1;}
    .hyper-word{
      font-weight:900;
      font-size:clamp(46px,12vw,88px);
      letter-spacing:-0.02em;
      background:linear-gradient(90deg,#fd2f4b,#ff9a5a,#ffd166,#06d6a0,#5fb3ff,#c79eff,#fd2f4b);
      background-size:400% 100%;
      -webkit-background-clip:text;
      background-clip:text;
      color:transparent;
      filter:drop-shadow(0 5px 14px rgba(253,47,75,.15));
      animation:hyper-sheen 7s linear infinite,hyper-pop .7s ease-out both;
    }
    .hyper-tm{
      font-weight:800;
      font-size:clamp(16px,3.2vw,22px);
      vertical-align:super;
      color:#fd2f4b;
    }
    .logo-sub {
      font-weight: 700;
      font-size: 13px;
      color: #475569;
      display: inline-flex;
      align-items: center;
      gap: 8px;
    }
    .logo-chip {
      display:inline-grid; place-items:center;
      width:26px; height:26px; border-radius:8px;
      background:#fd2f4b; color:#fff; font-weight:900;
      box-shadow: 0 8px 20px rgba(253,47,75,.25);
      transform: rotate(-6deg);
    }

    @keyframes hyper-sheen{0%{background-position:0% 0%}100%{background-position:100% 0%}}
    @keyframes hyper-pop{
      0%{transform:translateY(10px) scale(.92);opacity:0}
      60%{transform:translateY(0) scale(1.035);opacity:1}
      100%{transform:translateY(0) scale(1)}
    }

    /* File drop areas */
    .drop {
      border:1.5px dashed #e5e7eb;
      border-radius:14px;
      padding:14px;
      background:#fff;
    }
    .drop:hover { border-color:#fd2f4b; background:#fff7f8; }
    .progress { font-size:12px; color:#475569; }

    /* Two-column on md+ */
    @media (min-width: 960px) {
      .grid-auth { display:grid; grid-template-columns: 1.1fr .9fr; gap: 22px; }
      .only-mobile { display:none; }
    }
  </style>
</head>
<body>

  <!-- Top band with back link -->
  <div class="band">
    <div class="mx-auto max-w-5xl px-4 py-6 flex items-center justify-between">
      <a href="./index.html" class="inline-flex items-center gap-2 text-sm text-gray-600 hover:text-gray-900">‚Üê Back to Home</a>

      <!-- Simple tabs -->
      <div class="tabs">
        <button id="showSignIn" class="tab active">Sign In</button>
        <button id="showSignUp" class="tab">Create Account</button>
      </div>
    </div>
  </div>

  <!-- Main -->
  <main class="mx-auto max-w-5xl px-4 py-8 grid-auth">
    <!-- Left: Brand + copy -->
    <section class="shell p-6 md:p-8">
      <div class="hyper-logo" aria-label="HyperApply logo">
        <span class="hyper-word">RapidApply</span><span class="hyper-tm">‚Ñ¢</span>
      </div>
      <div class="logo-sub">
        <span class="logo-chip">SJ</span>
        Auto-apply engine by <span class="text-[#fd2f4b] font-extrabold">So Jobless BH</span>
      </div>

      <div class="mt-6 stack-lg">
        <div class="row">
          <div class="badge badge-yellow">‚ú® Fast</div>
          <div class="badge badge-mint">üóìÔ∏è Daily</div>
          <div class="badge badge-sky">üìé CV-aware</div>
        </div>
        <p class="text-gray-600 text-sm">
          Sign in to manage your profile, pick roles, and let the system apply for you every morning in üáßüá≠.
        </p>
        <ul class="text-sm text-gray-700 grid gap-2">
          <li>‚Ä¢ One profile ‚Üí dozens of applications</li>
          <li>‚Ä¢ Branded emails with your photo + intro</li>
          <li>‚Ä¢ Pause/resume anytime</li>
        </ul>
      </div>
    </section>

    <!-- Right: Auth card -->
    <section class="shell p-6 md:p-8">
      <!-- Sign In Panel -->
      <div id="panelSignIn" class="stack">
        <h1 class="text-xl font-extrabold tracking-tight">Welcome back</h1>
        <p class="muted">Use the email & password you registered with.</p>

        <div id="siAlert" class="alert alert-err hidden"></div>

        <div class="stack">
          <label class="hint">Email</label>
          <input id="siEmail" type="email" class="field" placeholder="you@email.com" autocomplete="email" />
          <label class="hint">Password</label>
          <input id="siPass" type="password" class="field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" autocomplete="current-password" />
          <button id="btnSignIn" class="btn btn-primary">Sign In</button>
          <button id="swapToUp1" class="btn btn-ghost only-mobile">Create a new account</button>
        </div>
      </div>

      <!-- Sign Up Panel -->
      <div id="panelSignUp" class="stack hidden">
        <h1 class="text-xl font-extrabold tracking-tight">Create account</h1>
        <p class="muted">All fields are required so we can apply on your behalf.</p>

        <div id="suAlert" class="alert alert-err hidden"></div>
        <div id="suSuccess" class="alert alert-ok hidden"></div>

        <div class="stack-lg">
          <div class="stack">
            <label class="hint">Email</label>
            <input id="suEmail" type="email" class="field" placeholder="you@email.com" required />
          </div>
          <div class="stack">
            <label class="hint">Password (min 6)</label>
            <input id="suPass" type="password" class="field" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢‚Ä¢" required />
          </div>

          <div class="row">
            <div class="stack" style="flex:1">
              <label class="hint">Full name</label>
              <input id="suFullName" type="text" class="field" placeholder="Jane Doe" required />
            </div>
            <div class="stack" style="flex:1">
              <label class="hint">Profession</label>
              <input id="suProfession" type="text" class="field" placeholder="Sales Associate" required />
            </div>
          </div>

          <div class="stack">
            <label class="hint">About you</label>
            <textarea id="suAbout" rows="3" class="field" placeholder="Short bio" required></textarea>
          </div>

          <div class="stack">
            <label class="hint">Profile Photo (JPG/PNG)</label>
            <label class="drop" for="suPhotoFile">Tap to select an image‚Ä¶</label>
            <input id="suPhotoFile" type="file" accept="image/*" class="hidden" required />
            <div id="photoProg" class="progress hidden"></div>
          </div>

          <div class="stack">
            <label class="hint">CV (PDF)</label>
            <label class="drop" for="suCVFile">Tap to select a PDF‚Ä¶</label>
            <input id="suCVFile" type="file" accept="application/pdf" class="hidden" required />
            <div id="cvProg" class="progress hidden"></div>
          </div>

          <button id="btnSignUp" class="btn btn-primary">Create account</button>
          <button id="swapToIn1" class="btn btn-ghost only-mobile">I already have an account</button>
        </div>
      </div>
    </section>
  </main>

  <!-- Firebase + Auth logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js";
    import { getDatabase, ref as dbRef, set } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-database.js";
    import { getStorage, ref as stRef, uploadBytesResumable, getDownloadURL } from "https://www.gstatic.com/firebasejs/10.13.1/firebase-storage.js";
    import { firebaseConfig } from "./firebaseConfig.js";

    /* Init */
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getDatabase(app);
    const storage = getStorage(app);

    /* Helpers */
    const $ = (i) => document.getElementById(i);
    const show = (id, msg) => { const n = $(id); n.textContent = msg; n.classList.remove("hidden"); };
    const hide = (id) => $(id).classList.add("hidden");
    const busy = (el, on, labelOn, labelOff) => { el.disabled = on; el.classList.toggle("disabled", on); el.textContent = on ? labelOn : labelOff; };

    /* Tabs switching */
    const tabIn  = $('showSignIn');
    const tabUp  = $('showSignUp');
    const pIn    = $('panelSignIn');
    const pUp    = $('panelSignUp');

    function setTab(which){
      if (which === 'in'){
        tabIn.classList.add('active'); tabUp.classList.remove('active');
        pIn.classList.remove('hidden'); pUp.classList.add('hidden');
      } else {
        tabUp.classList.add('active'); tabIn.classList.remove('active');
        pUp.classList.remove('hidden'); pIn.classList.add('hidden');
      }
      // Clear alerts
      hide('siAlert'); hide('suAlert'); hide('suSuccess');
    }
    // Wire buttons/tabs
    tabIn.addEventListener('click', ()=>setTab('in'));
    tabUp.addEventListener('click', ()=>setTab('up'));
    $('swapToUp1')?.addEventListener('click', ()=>setTab('up'));
    $('swapToIn1')?.addEventListener('click', ()=>setTab('in'));

    // Ensure default view is Sign In
    document.addEventListener('DOMContentLoaded', ()=> setTab('in'));

    /* Validation (Sign Up) */
    function validateSignUp(){
      hide('suAlert'); hide('suSuccess');
      const email = $('suEmail').value.trim();
      const pass  = $('suPass').value;
      const fullName   = $('suFullName').value.trim();
      const profession = $('suProfession').value.trim();
      const about      = $('suAbout').value.trim();
      const photoFile  = $('suPhotoFile').files[0];
      const cvFile     = $('suCVFile').files[0];

      if (!email || !pass || !fullName || !profession || !about || !photoFile || !cvFile) {
        show('suAlert', 'Please complete all fields and attach both files.'); return null;
      }
      if (!/^\S+@\S+\.\S+$/.test(email)) { show('suAlert', 'Enter a valid email address.'); return null; }
      if (pass.length < 6) { show('suAlert', 'Password must be at least 6 characters.'); return null; }
      if (!photoFile.type.startsWith('image/')) { show('suAlert', 'Profile photo must be an image file.'); return null; }
      if (cvFile.type !== 'application/pdf') { show('suAlert', 'CV must be a PDF file.'); return null; }
      return { email, pass, fullName, profession, about, photoFile, cvFile };
    }

    /* Upload with progress */
    function uploadWithProgress(file, path, progId) {
      const ref = stRef(storage, path);
      const task = uploadBytesResumable(ref, file);
      const progEl = $(progId);
      progEl.classList.remove('hidden');
      return new Promise((resolve, reject) => {
        task.on('state_changed', (snap) => {
          const pct = Math.round((snap.bytesTransferred / snap.totalBytes) * 100);
          progEl.textContent = `Uploading ${file.name}‚Ä¶ ${pct}%`;
        }, reject, async () => {
          const url = await getDownloadURL(task.snapshot.ref);
          progEl.textContent = `Uploaded ${file.name} ‚úì`;
          resolve(url);
        });
      });
    }

    /* Sign Up */
    $('btnSignUp').addEventListener('click', async () => {
      try {
        const data = validateSignUp(); if (!data) return;
        const btn = $('btnSignUp');
        busy(btn, true, 'Creating‚Ä¶', 'Create account');

        const { email, pass, fullName, profession, about, photoFile, cvFile } = data;

        // 1) Auth
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        const uid = cred.user.uid;

        // 2) Upload
        const id1 = (crypto.randomUUID?.() || Date.now()) + '_' + uid;
        const photoPath = `images/${id1}`;
        const cvPath    = `resumes/${id1}.pdf`;
        const [profileImageUrl, userCV] = await Promise.all([
          uploadWithProgress(photoFile, photoPath, 'photoProg'),
          uploadWithProgress(cvFile, cvPath, 'cvProg'),
        ]);

        // 3) DB write
        await set(dbRef(db, `users/${uid}/info`), {
          userId: uid,
          email,
          fullName,
          profession,
          about,
          profileImageUrl,
          userCV,
          role: "candidate",
          status: "live",
          phone: "unknown",
        });

        show('suSuccess', 'Account created successfully! Redirecting‚Ä¶');
        window.location.href = './app.html';
      } catch (e) {
        console.error(e);
        show('suAlert', e?.message || 'Could not create account.');
      } finally {
        busy($('btnSignUp'), false, 'Creating‚Ä¶', 'Create account');
      }
    });

    /* Sign In */
    $('btnSignIn').addEventListener('click', async () => {
      try {
        hide('siAlert');
        const email = $('siEmail').value.trim();
        const pass  = $('siPass').value;
        if (!email || !pass) { show('siAlert', 'Enter your email and password.'); return; }
        await signInWithEmailAndPassword(auth, email, pass);
        window.location.href = './app.html';
      } catch (e) {
        console.error(e);
        show('siAlert', e?.message || 'Sign-in failed.');
      }
    });
  </script>
</body>
</html>
